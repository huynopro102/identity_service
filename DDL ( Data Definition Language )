-- ngôn ngữ định nghĩa dữ liệu
-- public."permission" definition

-- Drop table

-- DROP TABLE public."permission";

CREATE TABLE public."permission" (
	"name" varchar(255) NOT NULL,
	code varchar(255) NULL,
	description varchar(255) NULL,
	is_active bool NULL, // Quyền này có đang được sử dụng hay không
	CONSTRAINT permission_pkey PRIMARY KEY ("name")
);


-- public.post_category definition

-- Drop table

-- DROP TABLE public.post_category;

CREATE TABLE public.post_category (
	id int8 GENERATED BY DEFAULT AS IDENTITY( MINVALUE 0 NO MAXVALUE START 0 NO CYCLE) NOT NULL,
	description text NULL,
	"name" varchar(255) NULL,
	CONSTRAINT post_category_pkey PRIMARY KEY (id)
);


-- public."role" definition

-- Drop table

-- DROP TABLE public."role";

CREATE TABLE public."role" (
	"name" varchar(255) NOT NULL,
	description varchar(255) NULL,
	CONSTRAINT role_pkey PRIMARY KEY ("name")
);


-- public.tags definition

-- Drop table

-- DROP TABLE public.tags;

CREATE TABLE public.tags (
	id int8 GENERATED BY DEFAULT AS IDENTITY( MINVALUE 0 NO MAXVALUE START 0 NO CYCLE) NOT NULL,
	"name" varchar(255) NULL,
	CONSTRAINT tags_pkey PRIMARY KEY (id)
);


-- public.users definition

-- Drop table

-- DROP TABLE public.users;

CREATE TABLE public.users (
	id varchar(255) NOT NULL,
	created_at timestamp(6) NOT NULL,
	deleted_at timestamp(6) NULL,
	dob date NULL,
	email varchar(255) NOT NULL,
	email_verified bool NULL,
	failed_login_attempts int4 NULL,
	last_login_at timestamp(6) NULL,
	"password" varchar(255) NOT NULL,
	password_reset_expires timestamp(6) NULL,
	password_reset_token varchar(255) NULL,
	profile_image varchar(255) NULL,
	status varchar(255) NULL,
	updated_at timestamp(6) NOT NULL,
	username varchar(255) NOT NULL,
	CONSTRAINT uk6dotkott2kjsp8vw4d0m25fb7 UNIQUE (email),
	CONSTRAINT ukr43af9ap4edm43mmtq01oddj6 UNIQUE (username),
	CONSTRAINT users_pkey PRIMARY KEY (id),
	CONSTRAINT users_status_check CHECK ((((status)::text = ANY ((ARRAY['ACTIVE'::character varying, 'INACTIVE'::character varying, 'BANNED'::character varying])::text[]))))
);


-- public.posts definition

-- Drop table

-- DROP TABLE public.posts;

CREATE TABLE public.posts (
	id varchar(255) NOT NULL,
	"content" varchar(255) NULL,
	created_at timestamp(6) NOT NULL,
	deleted_at timestamp(6) NULL,
	is_published bool NULL,
	status varchar(255) NULL,
	title varchar(255) NULL,
	updated_at timestamp(6) NOT NULL,
	view_count int4 NULL,
	category_id int8 NULL,
	user_id varchar(255) NOT NULL,
	CONSTRAINT posts_pkey PRIMARY KEY (id),
	CONSTRAINT posts_status_check CHECK ((((status)::text = ANY ((ARRAY['DRAFT'::character varying, 'PUBLISHED'::character varying, 'DELETED'::character varying])::text[])))),
	CONSTRAINT fk5lidm6cqbc7u4xhqpxm898qme FOREIGN KEY (user_id) REFERENCES public.users(id),
	CONSTRAINT fkbch136ep449itdqlp6vm5gebi FOREIGN KEY (category_id) REFERENCES public.post_category(id)
);


-- public.role_permissions definition

-- Drop table

-- DROP TABLE public.role_permissions;

CREATE TABLE public.role_permissions (
	role_name varchar(255) NOT NULL,
	permission_name varchar(255) NOT NULL,
	CONSTRAINT role_permissions_pkey PRIMARY KEY (role_name,permission_name),
	CONSTRAINT fk5apxdynankvq5vbor6crl42g7 FOREIGN KEY (permission_name) REFERENCES public."permission"("name"),
	CONSTRAINT fkcppvu8fk24eqqn6q4hws7ajux FOREIGN KEY (role_name) REFERENCES public."role"("name")
);


-- public.user_roles definition

-- Drop table

-- DROP TABLE public.user_roles;

CREATE TABLE public.user_roles (
	user_id varchar(255) NOT NULL,
	role_name varchar(255) NOT NULL,
	CONSTRAINT user_roles_pkey PRIMARY KEY (user_id,role_name),
	CONSTRAINT fk53v9b6vwc56nm9llvcdhs8y8f FOREIGN KEY (role_name) REFERENCES public."role"("name"),
	CONSTRAINT fkhfh9dx7w3ubf1co1vdev94g3f FOREIGN KEY (user_id) REFERENCES public.users(id)
);


-- public.user_sessions definition

-- Drop table

-- DROP TABLE public.user_sessions;

CREATE TABLE public.user_sessions (
	id varchar(255) NOT NULL,
	device_info varchar(255) NULL,
	ip_private varchar(45) NULL,
	ip_public varchar(45) NULL,
	is_active bool NOT NULL,
	login_time timestamp(6) NULL,
	logout_time timestamp(6) NULL,
	network_name varchar(255) NULL,
	port int4 NULL,
	"token" varchar(255) NULL,
	user_agent text NULL,
	user_id varchar(255) NULL,
	CONSTRAINT user_sessions_pkey PRIMARY KEY (id),
	CONSTRAINT fk8klxsgb8dcjjklmqebqp1twd5 FOREIGN KEY (user_id) REFERENCES public.users(id)
);


-- public.post_comments definition

-- Drop table

-- DROP TABLE public.post_comments;

CREATE TABLE public.post_comments (
	id varchar(255) NOT NULL,
	"content" varchar(255) NULL,
	created_at timestamp(6) NULL,
	parent_comment_id varchar(255) NULL,
	post_id varchar(255) NOT NULL,
	user_id varchar(255) NOT NULL,
	CONSTRAINT post_comments_pkey PRIMARY KEY (id),
	CONSTRAINT fk21q7y8a124im4g0l4aaxn4ol1 FOREIGN KEY (parent_comment_id) REFERENCES public.post_comments(id),
	CONSTRAINT fkaawaqxjs3br8dw5v90w7uu514 FOREIGN KEY (post_id) REFERENCES public.posts(id),
	CONSTRAINT fksnxoecngu89u3fh4wdrgf0f2g FOREIGN KEY (user_id) REFERENCES public.users(id)
);


-- public.post_images definition

-- Drop table

-- DROP TABLE public.post_images;

CREATE TABLE public.post_images (
	id varchar(255) NOT NULL,
	image_description text NULL,
	image_url varchar(255) NULL,
	post_id varchar(255) NULL,
	CONSTRAINT post_images_pkey PRIMARY KEY (id),
	CONSTRAINT fko1i5va2d8de9mwq727vxh0s05 FOREIGN KEY (post_id) REFERENCES public.posts(id)
);


-- public.post_reactions definition

-- Drop table

-- DROP TABLE public.post_reactions;

CREATE TABLE public.post_reactions (
	id varchar(255) NOT NULL,
	created_at timestamp(6) NULL,
	reaction_type varchar(255) NULL,
	post_id varchar(255) NOT NULL,
	user_id varchar(255) NOT NULL,
	CONSTRAINT post_reactions_pkey PRIMARY KEY (id),
	CONSTRAINT fkptar8f3u0qt7ssjksu2hxme03 FOREIGN KEY (user_id) REFERENCES public.users(id),
	CONSTRAINT fkq9ivjiqt8flog43og7gtmoyqw FOREIGN KEY (post_id) REFERENCES public.posts(id)
);


-- public.post_tags definition

-- Drop table

-- DROP TABLE public.post_tags;

CREATE TABLE public.post_tags (
	post_id varchar(255) NOT NULL,
	tag_id int8 NOT NULL,
	CONSTRAINT post_tags_pkey PRIMARY KEY (post_id,tag_id),
	CONSTRAINT fkkifam22p4s1nm3bkmp1igcn5w FOREIGN KEY (post_id) REFERENCES public.posts(id),
	CONSTRAINT fkm6cfovkyqvu5rlm6ahdx3eavj FOREIGN KEY (tag_id) REFERENCES public.tags(id)
);